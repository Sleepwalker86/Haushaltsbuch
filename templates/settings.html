{% extends "base.html" %}
{% block content %}
<h1 class="mb-4">Einstellungen</h1>

{% if get_flashed_messages() %}
  <div class="mb-3">
    {% for msg in get_flashed_messages(with_categories=true) %}
      {% set cat, text = msg %}
      <div class="alert alert-{{ 'success' if cat == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
        {{ text }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="row g-4">
  <div class="col-12 col-lg-5">
    <h2 class="h5 mb-3">
      {% if edit_konto %}Konto bearbeiten{% else %}Neues Konto anlegen{% endif %}
    </h2>
    <form method="post">
      {% if edit_konto %}
        <input type="hidden" name="konto_id" value="{{ edit_konto.id }}">
      {% endif %}
      <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name"
               value="{{ edit_konto.name if edit_konto else '' }}"
               placeholder="z.B. Girokonto ING" required>
      </div>
      <div class="mb-3">
        <label for="beschreibung" class="form-label">Beschreibung</label>
        <textarea class="form-control" id="beschreibung" name="beschreibung" rows="2"
                  placeholder="z.B. Hauptkonto Haushalt">{{ edit_konto.beschreibung if edit_konto else '' }}</textarea>
      </div>
      <div class="mb-3">
        <label for="iban" class="form-label">IBAN</label>
        <input type="text" class="form-control" id="iban" name="iban"
               value="{{ edit_konto.iban if edit_konto else '' }}"
               placeholder="z.B. DE00 1234 5678 9000 0000 00">
      </div>
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
          {% if edit_konto %}Konto aktualisieren{% else %}Konto speichern{% endif %}
        </button>
        {% if edit_konto %}
          <a href="{{ url_for('settings') }}" class="btn btn-outline-secondary">Abbrechen</a>
        {% endif %}
      </div>
    </form>
  </div>

  <div class="col-12 col-lg-7">
    <h2 class="h5 mb-3">Vorhandene Konten</h2>
    {% if konten %}
    <div class="table-responsive">
      <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th style="width: 25%;">Name</th>
            <th style="width: 35%;">Beschreibung</th>
            <th style="width: 30%;">IBAN</th>
            <th style="width: 10%;" class="text-center">Aktion</th>
          </tr>
        </thead>
        <tbody>
          {% for k in konten %}
          <tr>
            <td>{{ k.name }}</td>
            <td>{{ k.beschreibung }}</td>
            <td>{{ k.iban }}</td>
            <td class="text-center">
              <a href="{{ url_for('settings', edit_id=k.id) }}"
                 class="btn btn-sm btn-primary d-inline-flex align-items-center justify-content-center"
                 style="width: 28px; height: 28px; padding: 0;"
                 title="Konto bearbeiten">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted">Noch keine Konten angelegt.</p>
    {% endif %}
  </div>

  <div class="row mb-2">
    <div class="col-12 col-md-3">
      <form method="post" action="{{ url_for('reload_categories') }}" class="mt-3">
        <button type="submit" class="btn btn-outline-secondary w-100">
          Kategorien neu laden
        </button>
      </form>
    </div>
  
    <div class="col-12 col-md-3">
      <form method="post" action="{{ url_for('import_data') }}" class="mt-3">
        <button type="submit" class="btn btn-outline-secondary w-100">
          CSV Daten einlesen
        </button>
      </form>
    </div>

    <div class="col-12 col-md-6">
      <form method="post" action="{{ url_for('upload_csv') }}" enctype="multipart/form-data" class="mt-3">
        <div class="input-group">
          <input type="file" class="form-control" name="csv_file" accept=".csv" required>
          <button type="submit" class="btn btn-outline-secondary">
            CSV hochladen
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}




